<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<head>
	<title>Hi Phone</title>
</head>
<style type="text/css">
	* { margin: 0; padding: 0; box-sizing: border-box; }
	canvas {
		position: absolute;
		z-index : 1;
		width: 100%;
		height: 100%;
	}
	#debugView {
		position: relative;
		z-index: 0;
		width: 100%;
		height: 100%;
	}
	#debugMessages > li {
		font-family: monospace;
	}
</style>
<body>

	<canvas>Hi canvas</canvas>
	<div id="debugView">
		<ul id="debugMessages">
			<li>1</li>
		</ul>
	</div>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">

	var socket = io();

	socket.on("set id", 
		function (msg){ var events = new CanvasEvents({'id' : msg});}
		);

	var CanvasEvents = function(options){
		var canvas = document.getElementsByTagName("canvas")[0];
		var ctx = canvas.getContext('2d');
		ctx.globalAlpha = 0.01;
		function log(message){
			var messageList = document.getElementById("debugMessages");
			var el = document.createElement("li");
				el.innerText = message;
				messageList.appendChild(el);
		}

		var self = {
			id : (function(x){
					if (typeof x === undefined) {
							return "0";
						} else {
							return x;
						}})(options["id"]),
			init: function(canvas){
				canvas.addEventListener("touchstart", self.handleStart, false);
				canvas.addEventListener("touchmove", self.handleMove, false);
				// canvas.addEventListener("touchcancel", self.handleCancel, false);
			  	canvas.addEventListener("touchleave", self.handleEnd, false);
			  	canvas.addEventListener("touchend", self.handleEnd, false);

			  	/////////////////ACCELEROMETER/////////////////

			  	// window.addEventListener("devicemotion", self.handleMotion, false);

			  	//////////////////SOCKET//////////////////////
			  	
			  	socket.on("message", function(msg){log(msg);});

			},
			handleStart: function(evt){
				// log("handleStart");
				socket.emit("tuio 1.0", "handleStart");
				evt.preventDefault();
			},
			handleMove: function(evt){
				// log("handleMove");
				socket.emit("tuio 1.0", "handleMove");
				evt.preventDefault();
			},
			handleEnd : function(evt){
				// log("handleEnd");
				socket.emit("tuio 1.0", "handleEnd	");
				evt.preventDefault();
			},
			// handleMotion : function(evt){
			// 	log(JSON.stringify( evt.acceleration ));
			// }
		};
		self.init(canvas);
	};

</script>
</body>
</html>
